{% extends "base.html" %}
{% load static %}
<title>{% block title %}Dashboard{% endblock %}</title> <!--Utiliser block title et block content pour le reste des pages-->

      {% block content %} <!--Ajout de l'html de la page entre block content et endblock-->
        <h1>Dashboard</h1>
        
            <div class="btn-create"> <!-- Div container affichage bouton haut Dashboard -->
                <div class="menu-item px-5"> <!-- Affichage bouton creation ticket -->
                    <a href="{% url 'create_ticket' %}" class="button">Demander une critique (Crea ticket)</a>							
                </div>
                
                <div class="menu-item px-5"> <!-- Affichage bouton creation ticket+critique -->
                    <a href="{% url 'create_ticket_and_review' %}" class="button">Creer une critique (ticket + Critique)</a>							
                </div>
            </div>

            
        
            
          <!-- Affichage Critique + Ticket -->
          <div class="reviews">
            {% for post  in posts %}
                {% if post.content_type == 'REVIEW' %} <!-- Condition si review > Ticket puis review -->
                    <div class="review">

                        <p>
                            {% if post.user == request.user %} <!--Affichage du  créateur de la critique-->
                            Vous avez publié une critique
                            {% else %}
                            {{post.user}} a publié une critique
                            {% endif %}
                        </p>

                        <p>{{ post.time_created }}</p> <!--Affichage de la date de création de la critique-->

                        <h3>{{ post.headline }}</h3>
                        <p>{{ post.body }}</p>
                        <p>Rating: {{ post.rating }}</p>  <!-- Afficher le rating ici -->
                        
                        <div class="ticket">
                            <p> Ticket : {{ post.user }}</p> <!-- Affichage auteur du ticket -->
                            <h4>{{ post.ticket.title }}</h4> <!-- lien entre les models Review et Tickets-->
                            <p>{{ post.ticket.description }}</p>
                            {% if post.ticket.image %}
                                <img src="{{ post.ticket.image.url }}" alt="{{ post.ticket.title }}" class="ticket-image">
                            {% endif %}
                        </div>
                    </div>
                {% elif post.content_type == 'TICKET' %} <!-- Condition si pas review > ticket uniquement -->
                    <div class="ticket">
                        
                        <p>
                            {% if post.user == request.user %} <!--Affichage du demandeur du créateur du ticket-->
                            Vous avez demandé une critique
                            {% else %}
                            {{post.user}} a demandé une critique
                            {% endif %}
                        </p>

                        <p>{{ post.time_created }}</p> <!--Affichage de la date de création du ticket-->

                        <h3>{{ post.title }}</h3>
                        <p>{{ post.description }}</p>
                        {% if post.image %}
                            <img src="{{ post.image.url }}" alt="{{ post.title }}" class="ticket-image">
                        {% endif %}
                        
                        <!-- On recupere les informations db via 
                            le models qui retourne un booleen selon si la critique existe ou pas  -->
                        {% if not post.review_set.exists %}
                            <!--Le bouton est supprimé de facon dynamique si une critique existe déja-->
                            <a href="{% url 'create_review' ticket_id=post.id %}" class="button">Créer une critique</a>
                        
                        {% endif %} 


                    </div>
                {% endif %}

            {% empty %}
                <p>Aucune critique trouvée</p>
            {% endfor %}
          </div>

          
          

          <!-- Bouton de deconnection -->
          <div class="menu-item px-5">
              <a href="{% url 'logout' %}" class="button">Se déconnecter</a>	<!--Toutes les redirections se font sur ce format-->						
          </div>

      {% endblock %}
      











